## Nim游戏

Nim游戏是经典的公平组合游戏(ICG)，对于ICG游戏我们有如下**定义**：

1. 两名选手；
2. 两名选手轮流行动，每一次行动可以在有限合法操作集合中选择一个；
3. 游戏的任何一种可能的局面(position)，合法操作集合只取决于这个局面本身；局面的改变称为“移动”(move)。
4. 若轮到某位选手时，该选手的合法操作集合为空，则这名选手判负。

对于第三条，我们有更进一步的定义Position，我们将Position分为两类：
- P-position：在当前的局面下，先手必败。
- N-position：在当前的局面下，先手必胜。

他们有如下**性质**：
1. 合法操作集合为空的局面是P-position；
2. 可以移动到P-position的局面是N-position；
3. 所有移动都只能到N-position的局面是P-position。
4. 对于一个局面，当且仅当A[1] xor A[2] xor ... xor A[N] = 0时，该局面为P局面。

对于这个结论的**证明**如下：
1. 全0状态为P局面，即A[i]=0，则A[1] xor A[2] xor ... xor A[N] = 0。
2. 从任意一个A[1] xor A[2] xor ... xor A[N] = k != 0的状态可以移动到A[1] xor A[2] xor ... xor A[N] = 0的状态。由于xor计算的特殊性，我们知道一定有一个A[i]最高位与k最高位的1是相同的，那么必然有A[i] xor k < A[i]的，所以我们可以通过改变A[i]的值为A[i]'，使得A[1] xor A[2] xor ... xor A[i]' xor ... xor A[N] = 0。
3. 对于任意一个局面，若A[1] xor A[2] xor ... xor A[N] = 0，则不存在任何一个移动可以使得新的局面A[1] xor A[2] xor ... xor A[N] = 0。由于xor计算的特殊性，我们可以知道，一定是存在偶数个1时该位置的1才会被消除。若只改变一个A[i]，无论如何都会使得1的数量发生变化，从而导致A[1] xor A[2] xor ... xor A[N] != 0。
 
以上三条满足ICG游戏中N,P局面的转移性质，所以该结论的正确性也得到了证明.

**所以当所有A[i]的异或和为0，下一步移动后异或和必不为0，同理非零移动后可以为0**.
### Sprague-Grundy定理

#### "mex"(𝑆) = min{𝑥|𝑥∈𝑁,𝑥∉𝑆}
#### "SG" (𝑠)="mex" (𝑇)

1. 当前状态的SG值s是所有**后继状态的SG值**构成的集合T中不包含的最小的自然数(终止状态的SG值为0).
2. SG值为0的状态为必败态,非0的状态为必胜态(注意这里讨论的问题默认都是无法操作者败).
3. 多个子游戏的和的SG值为各个子游戏SG值的异或和.

## SG函数求不出时，打表找规律，或者直接凭感觉


### 巴什博奕（Bash Game）
A和B一块报数，每人每次报最少1个，最多报4个，看谁先报到30。这应该是最古老的关于巴什博奕的游戏了吧。

其实如果知道原理，这游戏一点运气成分都没有，只和先手后手有关，比如第一次报数，A报k个数，那么B报5-k个数，那么B报数之后问题就变为，A和B一块报数，看谁先报到25了，进而变为20,15,10,5，当到5的时候，不管A怎么报数，最后一个数肯定是B报的，可以看出，作为后手的B在个游戏中是不会输的。

那么如果我们要报n个数，每次最少报一个，最多报m个，我们可以找到这么一个整数k和r，使n=k*（m+1）+r，代入上面的例子我们就可以知道，如果r=0，那么先手必败；否则，先手必胜。


**依旧数学归纳…
SG(x)=xmod(m+1)**
### 威佐夫博弈
威佐夫游戏是一个尼姆游戏（双人数学博弈游戏），规则是两人
轮流取两堆筹码，其中取法有两种：取走一堆中任意个筹码，或
从两堆中取走相同数目的筹码。取完所有筹码的一方获胜。

可以用两个数（a[k],b[k]）（ps：（a[k]≤b[k]）k为一个自然数)表示两堆物品的数量。如果该数量为奇异局势，那么先手输;

前几个奇异局势如下：（0,0,）、（1,2）、（3,5）、（4,7）、（6,10）······起始值a[0]=b[0]=0;k=0;

可以看出a[k]是在之前未出现过的最小自然数，而b[k] = a[k]+k，k代表出现的第几个奇异局势；

性质：

1.任何自然数都包含在一个且仅有一个的奇异局势中。

证明：若(a[k],b[k])为一个奇异局势，因为b[k]=a[k]+k，a[k]>a[k-1]  =》  b[k] >a[k-1]+k >a[k-1]+k-1 =》 b[k-1] > a[k-1].

2.任何操作都会将奇异局势变成非奇异局势

由性质1可知，即使是同时减少，两个数的差值不变，所以不可能成为其他奇异局势的差，因此也是非奇异局势；

3.可采用适当的方法将非奇异局势变为奇异局势，那么下一个必输；

 
**结论：两个人如果都采用正确操作，那么面对非奇异局势，先拿者必胜；反之，则后拿者取胜。**
那么任给一个局势（a，b），怎样判断它是不是奇异局势呢？
我们有如下公式：a表示第一堆的个数，b表示第二堆的个数，c表示二者之差，当然a必须小于b;
再找规律的话我们会发现，a= c* 1.618 

而1.618 = （sqrt（5）+ 1） /  2 。

1 2
3 5
4 7
6 10

大家都知道0.618是黄金分割率。而威佐夫博弈正好是1.618，这就是博弈的奇妙之处！

给出 a,b 为非奇异局，则先手胜利，先手的操作方式输出： 形成奇异局势

```
 if(a>b)
 swap(a,b);
 double c=b-a;
 if((int)(c*goodval)==a)
 printf("0\n");
 else printf("1\n");
```
### 斐波那契博弈：

有一堆物品，两人轮流取物品，先手最少取一个，至多无上限，但不能把物品取完，之后每次取的物品数不能超过上一次取的物品数的二倍且至少为一件，取走最后一件物品的人获胜。

结论是：先手胜当且仅当n不是斐波那契数（n为物品总数）